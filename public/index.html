<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover"
    />
    <title>Tap or Tarp</title>
    <link rel="icon" type="image/svg+xml" href="logo.svg" />
    <link rel="manifest" href="manifest.json" />
    <link rel="apple-touch-icon" href="/icons/icon-192.png" />
    <meta name="theme-color" content="#4a5d23" />
    <link rel="stylesheet" href="style.css" />
  </head>
  <body>
    <div id="app">
      <!-- Main Menu Screen -->
      <div id="main-menu-screen">
        <h1>Tap or Tarp</h1>
        <div class="menu-container">
          <button id="menu-casual-btn" class="btn btn-menu">Start New Casual Game</button>
          <button id="menu-campaign-btn" class="btn btn-menu">Start New Campaign</button>
          <button id="menu-join-btn" class="btn btn-menu">Join Game</button>
          <button id="menu-load-btn" class="btn btn-menu">Load Game</button>
          <button id="menu-settings-btn" class="btn btn-menu">Settings</button>
          <button id="menu-feedback-btn" class="btn btn-menu">Feedback</button>
        </div>
      </div>

      <!-- Casual Game Setup Screen -->
      <div id="casual-setup-screen" style="display: none">
        <h1>New Casual Game</h1>
        <div class="setup-form">
          <div class="form-group">
            <label for="game-name">Game Name</label>
            <input
              type="text"
              id="game-name"
              placeholder="Enter game name (optional)"
              maxlength="50"
            />
          </div>
          <div class="form-group">
            <label for="player-count">Number of Players (2-8)</label>
            <input type="number" id="player-count" min="2" max="8" value="2" />
          </div>
          <div class="form-group">
            <label for="initial-time">Starting Time (minutes)</label>
            <input type="number" id="initial-time" min="1" value="10" />
          </div>
          <div class="menu-actions">
            <button id="create-game" class="btn btn-primary" aria-label="Create new game">
              Create Game
            </button>
            <button id="casual-back-btn" class="btn btn-secondary" aria-label="Back to menu">
              Back
            </button>
          </div>
        </div>
      </div>

      <!-- Join Game Screen -->
      <div id="join-screen" style="display: none">
        <h1>Join Game</h1>
        <div class="setup-form">
          <div class="form-group">
            <label>Active Lobbies</label>
            <div id="game-list" class="game-list">
              <p class="loading">Loading games...</p>
            </div>
            <p class="form-hint">Tap a game to join</p>
          </div>
          <div class="form-group-divider">
            <span>OR</span>
          </div>
          <div class="form-group">
            <label for="join-game">Enter Game Code</label>
            <input type="text" id="join-game" placeholder="e.g. ABC123" maxlength="6" />
          </div>
          <div class="menu-actions">
            <button id="join-btn" class="btn btn-primary" aria-label="Join game">Join</button>
            <button id="join-back-btn" class="btn btn-secondary" aria-label="Back to menu">
              Back
            </button>
          </div>
        </div>
      </div>

      <!-- Campaign Screen (Placeholder) -->
      <div id="campaign-screen" style="display: none">
        <h1>Campaign Mode</h1>
        <div class="placeholder-content">
          <p>Campaign mode coming soon!</p>
          <button id="campaign-back-btn" class="btn btn-secondary" aria-label="Back to menu">
            Back to Menu
          </button>
        </div>
      </div>

      <!-- Load Game Screen (Placeholder) -->
      <div id="load-screen" style="display: none">
        <h1>Load Game</h1>
        <div class="placeholder-content">
          <p>No saved games found.</p>
          <button id="load-back-btn" class="btn btn-secondary" aria-label="Back to menu">
            Back to Menu
          </button>
        </div>
      </div>

      <!-- Menu Settings Screen -->
      <div id="menu-settings-screen" style="display: none">
        <h1>Settings</h1>
        <div class="setup-form">
          <div class="form-group checkbox-group">
            <label>
              <input type="checkbox" id="menu-mute-checkbox" />
              Mute Audio
            </label>
          </div>
          <div class="menu-actions">
            <button id="menu-settings-save-btn" class="btn btn-primary" aria-label="Save settings">
              Save
            </button>
            <button id="menu-settings-back-btn" class="btn btn-secondary" aria-label="Back to menu">
              Back
            </button>
          </div>
        </div>
      </div>

      <!-- Feedback Screen -->
      <div id="feedback-screen" style="display: none">
        <h1>Feedback</h1>
        <div id="feedback-form-section" class="setup-form">
          <div class="form-group">
            <label for="feedback-text">Your Feedback</label>
            <textarea
              id="feedback-text"
              class="feedback-textarea"
              maxlength="255"
              placeholder="Share your thoughts, suggestions, or report issues..."
              rows="5"
            ></textarea>
            <p class="form-hint"><span id="feedback-char-count">0</span>/255 characters</p>
          </div>
          <div class="menu-actions">
            <button id="feedback-submit-btn" class="btn btn-primary" aria-label="Submit feedback">
              Submit Feedback
            </button>
            <button
              id="feedback-view-btn"
              class="btn btn-secondary"
              aria-label="View saved feedback"
            >
              View Feedback
            </button>
            <button id="feedback-back-btn" class="btn btn-secondary" aria-label="Back to menu">
              Back
            </button>
          </div>
        </div>

        <div id="feedback-list-section" style="display: none">
          <h2>Your Feedback</h2>
          <div id="feedback-list" class="feedback-list"></div>
          <div class="menu-actions">
            <button id="feedback-add-btn" class="btn btn-primary" aria-label="Add new feedback">
              Add New Feedback
            </button>
            <button id="feedback-list-back-btn" class="btn btn-secondary" aria-label="Back to menu">
              Back
            </button>
          </div>
        </div>
      </div>

      <div id="game-screen" style="display: none">
        <div class="game-header">
          <div class="game-header-left">
            <h1 id="game-title-display">Tap or Tarp</h1>
            <div class="game-code">Game Code: <span id="game-code-display"></span></div>
          </div>
        </div>

        <div id="players-container"></div>

        <div class="controls">
          <button
            id="start-btn"
            class="btn btn-control btn-primary"
            style="display: none"
            aria-label="Start game"
          >
            Start Game
          </button>
          <button
            id="random-start-btn"
            class="btn btn-control"
            style="display: none"
            aria-label="Select random starting player"
            title="Randomly select starting player"
          >
            üé≤ Random Start
          </button>
          <button id="pass-turn-btn" class="btn btn-control" aria-label="Pass turn to next player">
            Pass Turn
          </button>
          <button
            id="interrupt-btn"
            class="btn btn-control"
            aria-label="Interrupt turn"
            style="display: none"
          >
            Interrupt
          </button>
          <button id="pause-btn" class="btn btn-control" aria-label="Pause or resume game">
            Pause
          </button>
          <button id="reset-btn" class="btn btn-control" aria-label="Reset game">Reset</button>
          <button id="dice-btn" class="btn btn-control" aria-label="Roll dice">
            üé≤ Dice
          </button>
          <button id="settings-btn" class="btn btn-control" aria-label="Open settings">
            Settings
          </button>
          <button id="back-to-menu-btn" class="btn btn-control" aria-label="Return to main menu">
            Back to Menu
          </button>
        </div>
      </div>

      <!-- Mobile Game Screen (New Redesigned Layout) -->
      <div id="mobile-game-screen" class="mobile-layout" style="display: none" role="main" aria-label="Game screen">
        <header class="mobile-top-bar" role="banner">
          <button class="mobile-icon-btn mobile-exit-btn" aria-label="Exit to main menu">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <path d="M19 12H5M12 19l-7-7 7-7"/>
            </svg>
          </button>
          <button class="mobile-icon-btn mobile-settings-btn" aria-label="Open game settings">
            <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" aria-hidden="true">
              <circle cx="12" cy="12" r="3"/>
              <path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/>
            </svg>
          </button>
        </header>

        <section class="mobile-time-display" aria-label="Game status">
          <div class="mobile-turn-indicator" role="status" aria-live="polite">YOUR TURN</div>
          <div class="mobile-time-value" role="timer" aria-live="off" aria-atomic="true">05:23</div>
        </section>

        <section class="mobile-interaction-area" aria-label="Main action">
          <button class="mobile-interaction-btn mobile-interaction-btn-pass" aria-label="Pass turn to next player">
            PASS TURN
          </button>
        </section>

        <section class="mobile-other-players" aria-label="Other players">
          <div class="mobile-player-cards" role="list">
            <!-- Player cards will be inserted here dynamically -->
          </div>
        </section>

        <footer class="mobile-player-stats" aria-label="Your stats">
          <!-- Player name row (visible in waiting state) -->
          <div class="mobile-player-name-row">
            <span class="mobile-player-name-label">You:</span>
            <span class="mobile-player-name-value">Player 1</span>
          </div>
          <!-- Stats row -->
          <div class="mobile-stats-row">
            <div class="mobile-stat-group mobile-stat-life" role="group" aria-label="Life total">
              <div class="mobile-stat-header">
                <span class="mobile-stat-icon" aria-hidden="true">&#10084;</span>
                <span class="mobile-stat-value" aria-live="polite">20</span>
              </div>
              <div class="mobile-stat-controls">
                <button class="mobile-stat-btn" aria-label="Decrease life by 1">-</button>
                <button class="mobile-stat-btn" aria-label="Increase life by 1">+</button>
              </div>
            </div>
            <div class="mobile-stat-group mobile-stat-poison" role="group" aria-label="Drunk counter">
              <div class="mobile-stat-header">
                <span class="mobile-stat-icon" aria-hidden="true">&#127866;</span>
                <span class="mobile-stat-value" aria-live="polite">0</span>
              </div>
              <div class="mobile-stat-controls">
                <button class="mobile-stat-btn" aria-label="Decrease drunk counter">-</button>
                <button class="mobile-stat-btn" aria-label="Increase drunk counter">+</button>
              </div>
            </div>
            <div class="mobile-stat-group mobile-stat-generic" role="group" aria-label="Generic counter">
              <div class="mobile-stat-header">
                <span class="mobile-stat-icon" aria-hidden="true">&#11088;</span>
                <span class="mobile-stat-value" aria-live="polite">0</span>
              </div>
              <div class="mobile-stat-controls">
                <button class="mobile-stat-btn" aria-label="Decrease generic counter">-</button>
                <button class="mobile-stat-btn" aria-label="Increase generic counter">+</button>
              </div>
            </div>
          </div>
        </footer>
      </div>

      <!-- Desktop Settings Modal -->
      <div id="settings-modal" style="display: none" class="modal desktop-only-modal">
        <div class="modal-content">
          <h2>Game Settings</h2>

          <div class="form-group">
            <label>Game Code</label>
            <div class="game-code-display" id="settings-game-code"></div>
          </div>

          <div class="form-group">
            <label>Warning Thresholds</label>
            <p class="form-hint">Audio alerts when time remaining drops below these values</p>
            <div id="thresholds-container" class="thresholds-container">
              <div class="threshold-item" data-index="0">
                <input type="number" class="threshold-input" value="5" min="0.1" step="0.5" />
                <span class="threshold-unit">min</span>
                <button type="button" class="btn-threshold-remove" aria-label="Remove threshold">
                  &times;
                </button>
              </div>
              <div class="threshold-item" data-index="1">
                <input type="number" class="threshold-input" value="1" min="0.1" step="0.5" />
                <span class="threshold-unit">min</span>
                <button type="button" class="btn-threshold-remove" aria-label="Remove threshold">
                  &times;
                </button>
              </div>
              <div class="threshold-item" data-index="2">
                <input type="number" class="threshold-input" value="0.5" min="0.1" step="0.1" />
                <span class="threshold-unit">min</span>
                <button type="button" class="btn-threshold-remove" aria-label="Remove threshold">
                  &times;
                </button>
              </div>
            </div>
            <button type="button" id="add-threshold-btn" class="btn btn-small btn-secondary">
              + Add Threshold
            </button>
          </div>

          <div class="form-group">
            <label>Your Color</label>
            <p class="form-hint">Customize your player card color</p>
            <div id="player-colors-container" class="player-colors-container"></div>
          </div>

          <div class="form-group">
            <label for="game-name-input">Rename Game</label>
            <input
              type="text"
              id="game-name-input"
              placeholder="Enter new game name (optional)"
              maxlength="50"
            />
            <p class="form-hint">Leave empty to keep current name</p>
          </div>

          <div class="form-group form-group-danger">
            <label>Danger Zone</label>
            <button type="button" id="close-lobby-btn" class="btn btn-small btn-danger">
              Close Lobby
            </button>
            <p class="form-hint">This will end the game for all players and close the lobby.</p>
          </div>

          <div class="modal-actions">
            <button id="save-settings" class="btn btn-primary" aria-label="Save settings">
              Save
            </button>
            <button id="close-settings" class="btn btn-secondary" aria-label="Close settings">
              Cancel
            </button>
          </div>
        </div>
      </div>

      <!-- Mobile Settings Modal (Tabbed) -->
      <div id="mobile-settings-modal" style="display: none" class="modal mobile-settings-modal">
        <div class="mobile-settings-content">
          <div class="mobile-settings-header">
            <h2>Settings</h2>
            <button class="mobile-settings-close" aria-label="Close">&times;</button>
          </div>

          <div class="mobile-settings-tabs" role="tablist" aria-label="Settings sections">
            <button class="mobile-settings-tab active" data-tab="controls" role="tab" aria-selected="true" aria-controls="panel-controls" id="tab-controls">Controls</button>
            <button class="mobile-settings-tab" data-tab="thresholds" role="tab" aria-selected="false" aria-controls="panel-thresholds" id="tab-thresholds">Thresholds</button>
            <button class="mobile-settings-tab" data-tab="more" role="tab" aria-selected="false" aria-controls="panel-more" id="tab-more">More</button>
          </div>

          <!-- Controls Tab -->
          <div class="mobile-settings-panel active" data-panel="controls" role="tabpanel" id="panel-controls" aria-labelledby="tab-controls">
            <div class="mobile-settings-buttons">
              <button id="mobile-pause-btn" class="mobile-settings-action-btn">
                <span class="action-icon">‚è∏</span>
                <span class="action-label">Pause</span>
              </button>
              <button id="mobile-reset-btn" class="mobile-settings-action-btn mobile-settings-action-btn-secondary">
                <span class="action-icon">üîÑ</span>
                <span class="action-label">Reset</span>
              </button>
              <button id="mobile-random-start-btn" class="mobile-settings-action-btn mobile-settings-action-btn-secondary" style="display: none">
                <span class="action-icon">üé≤</span>
                <span class="action-label">Random Start</span>
              </button>
              <button id="mobile-dice-btn" class="mobile-settings-action-btn mobile-settings-action-btn-secondary">
                <span class="action-icon">üé≤</span>
                <span class="action-label">Roll Dice</span>
              </button>
            </div>

            <div class="mobile-settings-section">
              <label class="mobile-settings-label">Player Color</label>
              <div id="mobile-color-picker" class="mobile-color-grid">
                <!-- Colors populated by JS -->
              </div>
            </div>
          </div>

          <!-- Thresholds Tab -->
          <div class="mobile-settings-panel" data-panel="thresholds" role="tabpanel" id="panel-thresholds" aria-labelledby="tab-thresholds" hidden>
            <div class="mobile-settings-section">
              <label class="mobile-settings-label">Warning Thresholds</label>
              <p class="mobile-settings-hint">Audio alerts at these times</p>
              <div id="mobile-thresholds-container" class="mobile-thresholds-list">
                <!-- Thresholds populated by JS -->
              </div>
              <button id="mobile-add-threshold-btn" class="mobile-add-btn">+ Add Threshold</button>
            </div>
          </div>

          <!-- More Tab -->
          <div class="mobile-settings-panel" data-panel="more" role="tabpanel" id="panel-more" aria-labelledby="tab-more" hidden>
            <div class="mobile-settings-section">
              <label class="mobile-settings-label">Game Code</label>
              <div class="mobile-game-code" id="mobile-settings-game-code">ABC123</div>
            </div>

            <div class="mobile-settings-section">
              <label class="mobile-settings-label" for="mobile-game-name-input">Game Name</label>
              <input
                type="text"
                id="mobile-game-name-input"
                class="mobile-settings-input"
                placeholder="Enter game name"
                maxlength="50"
              />
            </div>

            <div class="mobile-settings-section mobile-danger-zone">
              <label class="mobile-settings-label">Danger Zone</label>
              <button id="mobile-close-lobby-btn" class="mobile-danger-btn">Close Lobby</button>
            </div>
          </div>

          <div class="mobile-settings-footer">
            <button id="mobile-settings-save" class="btn btn-primary">Save</button>
            <button id="mobile-settings-cancel" class="btn btn-secondary">Cancel</button>
          </div>
        </div>
      </div>

      <div id="color-picker-modal" style="display: none" class="modal">
        <div class="modal-content modal-small">
          <h3>Choose Color</h3>
          <div id="color-options" class="color-options"></div>
          <div class="modal-actions">
            <button id="cancel-color-picker" class="btn btn-secondary">Cancel</button>
          </div>
        </div>
      </div>

      <div id="timeout-modal" style="display: none" class="modal">
        <div class="modal-content modal-danger">
          <h2>TIMEOUT!</h2>
          <p id="timeout-message"></p>
          <button id="acknowledge-timeout" class="btn btn-primary" aria-label="Acknowledge timeout">
            Acknowledge
          </button>
        </div>
      </div>

      <!-- Toast Notifications Container -->
      <div id="toast-container" class="toast-container" aria-live="polite" aria-atomic="true"></div>

      <!-- Mobile Player Details Popup -->
      <div id="mobile-player-popup" class="mobile-player-popup" style="display: none">
        <div class="mobile-player-popup-content">
          <div class="mobile-player-popup-header">
            <span class="mobile-player-popup-name">Player Name</span>
            <button class="mobile-player-popup-close" aria-label="Close">&times;</button>
          </div>
          <div class="mobile-player-popup-body">
            <div class="mobile-player-popup-stat">
              <span class="mobile-player-popup-label">Time</span>
              <span class="mobile-player-popup-value mobile-player-popup-time">05:23</span>
            </div>
            <div class="mobile-player-popup-stat">
              <span class="mobile-player-popup-label">Life</span>
              <span class="mobile-player-popup-value mobile-player-popup-life">20</span>
            </div>
            <div class="mobile-player-popup-stat">
              <span class="mobile-player-popup-label">Drunk</span>
              <span class="mobile-player-popup-value mobile-player-popup-drunk">0</span>
            </div>
            <div class="mobile-player-popup-stat">
              <span class="mobile-player-popup-label">Counter</span>
              <span class="mobile-player-popup-value mobile-player-popup-generic">0</span>
            </div>
          </div>
        </div>
      </div>
    </div>

      <!-- Dice Rolling Modal -->
      <div id="dice-modal" class="modal" style="display: none" role="dialog" aria-labelledby="dice-modal-title" aria-modal="true">
        <div class="modal-content dice-modal-content">
          <h2 id="dice-modal-title">Roll Dice</h2>

          <div class="dice-selector">
            <label for="dice-sides-select">Number of sides</label>
            <select id="dice-sides-select" class="dice-select">
              <option value="2">D2 (Coin flip)</option>
              <option value="4">D4</option>
              <option value="6" selected>D6</option>
              <option value="8">D8</option>
              <option value="10">D10</option>
              <option value="12">D12</option>
              <option value="20">D20</option>
              <option value="custom">Custom...</option>
            </select>

            <div id="dice-custom-container" class="dice-custom-container" style="display: none">
              <label for="dice-custom-input">Enter number of sides</label>
              <input
                type="number"
                id="dice-custom-input"
                class="dice-custom-input"
                min="1"
                max="999"
                placeholder="1-999"
              >
              <span class="dice-custom-hint">Enter a value between 1 and 999</span>
            </div>
          </div>

          <div id="dice-last-result" class="dice-last-result" style="display: none">
            <span class="dice-result-label">Last roll:</span>
            <span id="dice-result-display" class="dice-result-display"></span>
          </div>

          <div class="modal-actions">
            <button id="roll-dice-btn" class="btn btn-primary dice-roll-btn">
              üé≤ Roll
            </button>
            <button id="close-dice-modal" class="btn btn-secondary">
              Close
            </button>
          </div>
        </div>
      </div>

      <!-- Dice Result Toast -->
      <div id="dice-toast" class="dice-toast" style="display: none" role="alert" aria-live="polite">
        <div class="dice-toast-content">
          <div class="dice-toast-header">
            <span class="dice-roller-name"></span>
            <span class="dice-roll-info">rolled a D<span class="dice-sides-display"></span></span>
          </div>
          <div class="dice-result-large"></div>
        </div>
      </div>
    </div>

    <script src="constants.js"></script>
    <script src="client.js"></script>
  </body>
</html>
